---
title: "TADBD"
Author:
  - name: Hongqiang Lyu
  - name: Lin Li
date: '`r format(Sys.Date(), "%B %e, %Y")`'
abstract: >
  Topological Associated Domain (TAD) is a self-interacting genomic block. The detection of TAD boundaries on Hi-C contact matrix is one of the most important issues in the analysis of 3D genome architecture at TAD level. Here, we present TADBD, a sensitive and fast computational method for detection of TAD boundaries on Hi-C contact matrix. It implements a Haar-based algorithm considering Haar diagonal template, the acceleration via a compact integrogram, multi-scale aggregation at template size, and statistical filtering. Compared with the other five methods, including HiCDB, IC-Finder, EAST, TopDom and HiCseg, on simulated and experimental data, TADBD shows a better performance in most cases. In addition, a freely available R package is given to facilitate the use of the presented method.
package: TADBD
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TADBD}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editior_options:
  chunk_output_type: console
---

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```

# Introduction
`TADBD` is a fast and sensitive tool for detection of TAD boundaries on Hi-C contact matrix. A Haar-based algorithm is proposed to detect TAD boundaries on Hi-C contact matrix. In view of the geometry of TAD, a diagonal template is chosen to extract Haar feature of each point on the diagonal of contact matrix, by considering multi-scale aggregation at template size. Then the peaks on the average Haar feature value curve are located, and statistical filtering is performed to determine those significant ones as the final TAD boundaries. Furthermore, the feature extraction procedure is accelerated with the help of a compact integrogram.
 
 The package contains three functions, `DataLoad()` , `TADBD()` and `Output()` with the function of loading data, detecting TAD boundaries and outputing the result. The input contact matrix can be dense or sparse, that is to say, the resulting files or memory objects of multiple contact matrix preparation tools and most Hi-C normalization approaches are acceptable. As output, the final detected TAD boundaries can be given in an optional form between text and graphics. 

# Getting Started

## Installation

```{r, eval = FALSE, message=FALSE}
# if (!requireNamespace("BiocManager", quietly=TRUE))
#     install.packages("BiocManager")
# BiocManager::install("TADBD")
#install.packages("devtools") # if you have not installed "devtools" package
#devtools::install_github("bioinfo-lab/TADBD")
#library(TADBD)
```

## Input data
### working with a Hi-C matrix file
The input contact matrix can be dense or sparse. 
#### sparse format
Below is an example of loading data when 'hicmat' is in sparse format
```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Load R package TADBD
#library(TADBD)
#Configuration of the parameters, including species, chromsome and resolution
#species <- "hg19"
#chr <- "chr18"
#resolution <- 50000
#Close scientific notation
#options(scipen = 999)
#Specify Hi-C data to be loaded
#data(hicdata)
#Load a Hi-C contact matrix file in a sparse format
#hicmat <- DataLoad(hicdata, bsparse = TRUE, species, chr, resolution)
```

#### dense format
Below is an example of loading data when 'hicmat' is in dense format
```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Load R package TADBD
library(TADBD)
#Configuration of the parameters, including species, chromsome and resolution
species <- "hg19"
chr <- "chr18"
resolution <- 50000
#Close scientific notation
options(scipen = 999)
#Specify Hi-C data to be loaded
data(hicdata)
#Load a Hi-C contact matrix file in a dense format
hicmat <- DataLoad(hicdata, bsparse = FALSE, species, chr, resolution)
```


## Running TADBD
Once matrices that the function `LoadData()` outputs are in an acceptable format, `TADBD()` can be run with only one parameter. Below we show how to run the algorithm, and `TADBD()` outputs the the bin number of TAD boundaries on the contact matrix  
```{r, message = FALSE, warning = FALSE}
#Load R package TADBD
library(TADBD)
#Configuration of the parameters, including species, chromsome and resolution
species <- "hg19"
chr <- "chr18"
resolution <- 50000
#Close scientific notation
options(scipen = 999)
#Specify Hi-C data to be loaded
data(hicdata)
#Load a Hi-C contact matrix file in a dense format
hicmat <- DataLoad(hicdata, bsparse = FALSE, species, chr, resolution)
#Detect TAD boundaries on the loaded contact matrix using TADBD method
df_result <- TADBD(hicmat)
```

## Detecting TAD boundaries
Our method is specifically designed to detect TAD boundaries. The function `output()` takes the bin number of the detected TAD boundaries as input, and outputs the TAD boundaries in an optional form between text file and graphical heatmap. Below is an example of running the function `output()`.
### Output two text files, one is for detected TAD boundaries, the other for intermediate peaks
```{r, message = FALSE}
#Load R package TADBD
library(TADBD)
#Configuration of the parameters, including species, chromsome and resolution
species <- "hg19"
chr <- "chr18"
resolution <- 50000
#Close scientific notation
options(scipen = 999)
#Specify Hi-C data to be loaded
data(hicdata)
#Load a Hi-C contact matrix file in a dense format
hicmat <- DataLoad(hicdata, bsparse = F, species, chr, resolution)
#Detect TAD boundaries on the loaded contact matrix using TADBD method
df_result <- TADBD(hicmat)
#Output two text files, one is for detected TAD boundaries, the other for intermediate peaks
Output(df_result, species, chr, resolution, outxtfile="./result")
```
### Output a heatmap
```{r, message = FALSE}
#Load R package TADBD
library(TADBD)
#Configuration of the parameters, including species, chromsome and resolution
species <- "hg19"
chr <- "chr18"
resolution <- 50000
#Close scientific notation
options(scipen = 999)
#Specify Hi-C data to be loaded
data(hicdata)
#Load a Hi-C contact matrix file in a dense format
hicmat <- DataLoad(hicdata, bsparse = F, species, chr, resolution)
#Detect TAD boundaries on the loaded contact matrix using TADBD method
df_result <- TADBD(hicmat)
#Configuration of parameters of the heatmap, which include the starting coordinate and the ending coordinate of the heatmap
map_start <- 0
map_end <- 10000000
#Specify the parameters of TAD tracks
l_color <- "blue"
l_width <- 2.5
#Output a text file with TAD boundary coordinates, as well as a heatmap with TAD boundary tracks
Output(df_result, species, chr, resolution, outxtfile="./result", bheatmap = TRUE, heatmapfile="./heatmap", hicmat, map_start, map_end, l_color, l_width)
```

# Reference

# SessionInfo
sessionInfo（）
